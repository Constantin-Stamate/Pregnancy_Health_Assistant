<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Pregnancy Assistant</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

     <!--Application logo placement-->
     <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.png') }}">

    <!--Importing CSS files into the project-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/predict.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}"> 
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <!--Editing wallpaper properties-->
    <style>
        .breadcam_bg {
            background-image: url("{{ url_for('static', filename='images/index_bg_1.png') }}");
        }

        .bradcam_area {
            padding: 269px 0 159px 0;
            background-size: cover;
            background-position: center center;
            text-align: center;
        }
    </style>
</head>

<body>

<!--Implementing the main menu-->
<header>
    <div class="header-area ">
        <div id="sticky-header" class="main-header-area">
            <div class="container-fluid p-0">
                <div class="row align-items-center no-gutters">
                    <div class="col-xl-5 col-lg-6">
                        <div class="main-menu  d-none d-lg-block">
                            <nav>
                                <ul id="navigation">
                                    <li><a href="/">home</a></li>
                                    <li><a href="/predict">health</a></li>
                                    <li><a href="/result">result</a></li>
                                    <li><a class="active" href="/chat" style="background: transparent">healthAI</a>
                                    </li>
                                    <li><a href="/login">login</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2">
                        <div class="logo-img">
                            <a href="/">
                                <img src="{{ url_for('static', filename='images/favicon.png') }}" alt="" 
                                style=" width: 75px; height: 75px;">
                            </a>
                        </div>
                    </div>
                    <div class="col-xl-5 col-lg-4 d-none d-lg-block">
                        <div class="book_room">
                            <div class="book_btn d-none d-lg-block">
                                <a href="/predict">Predict fetal health</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!--Adding the page title-->
<div class="bradcam_area breadcam_bg">
    <h3>Interact with HealthAI</h3>
</div>

<!--Information on advice and predicting fetal health-->
<section class="sample-text-area">
    <div class="container box_1170">
        <h3 class="text-heading">Your Personalized Health Advice!</h3>
        <p class="sample-text">
            Based on the medical data you provided and the prediction generated for fetal health,
            our HealthAI chat is here to guide you with personalized tips and advice.
            Ask questions and receive valuable insights on how to take better care of your baby's health.
        </p>
    </div>
</section>

<!--HealthAI-->
<div class="container-fluid h-100">
    <div class="row justify-content-center h-100">
        <div class="col-md-8 col-xl-6 chat">
            <div class="card">
                <div class="card-header msg_head">
                    <div class="d-flex bd-highlight">
                        <div class="img_cont">
                            <img
                                    src="{{ url_for('static', filename='images/robot.jpg') }}"
                                    class="rounded-circle user_img"
                            />
                            <span class="online_icon"></span>
                        </div>
                        <div class="user_info">
                            <span>HealthAI</span>
                            <p style="font-size: 12px;">How can I assist you?</p>
                        </div>
                    </div>
                </div>
                <div id="messageForm" class="card-body msg_card_body"></div>
                <div class="card-footer">
                    <form id="messageArea" class="input-group">
                        <input
                                type="text"
                                id="text"
                                name="msg"
                                placeholder="Type your message..."
                                autocomplete="off"
                                class="form-control type_msg"
                                required
                        />
                        <div class="input-group-append">
                            <button type="submit" id="send" class="input-group-text send_btn">
                                <i class="fas fa-location-arrow"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Add final menu of the application-->
<footer class="footer" style="margin-top: 20px;">
    <div class="footer_top" style="padding: 35px 0;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 50px;"> <!-- Centrare container -->
            <div class="row" style="display: flex; justify-content: space-between; align-items: flex-start; gap: 50px;">
                <div class="col-xl-3 col-md-6 col-lg-3" style="margin-bottom: 10px; text-align: center;">
                    <!-- Centrare text -->
                    <div class="footer_widget">
                        <h3 class="footer_title">Project</h3>
                        <p class="footer_text">Application location<br></p>
                        <a href="https://github.com/Constantin-Stamate/Pregnancy_Health_Assistant" class="line-button">See
                            on GitHub</a>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-lg-3" style="margin-bottom: 10px; text-align: center;">
                    <!-- Centrare text -->
                    <div class="footer_widget">
                        <h3 class="footer_title">Authentication</h3>
                        <ul class="footer_links" style="list-style: none; padding: 0; margin: 0;">
                            <li><a href="/login">Login</a></li>
                            <li><a href="/register">Register</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-2 col-md-6 col-lg-2" style="margin-bottom: 10px; text-align: center;">
                    <!-- Centrare text -->
                    <div class="footer_widget">
                        <h3 class="footer_title">Navigation</h3>
                        <ul class="footer_links" style="list-style: none; padding: 0; margin: 0;">
                            <li><a href="/">Home</a></li>
                            <li><a href="/predict">Health</a></li>
                            <li><a href="/result">Result</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-2 col-md-6 col-lg-2" style="margin-bottom: 10px; text-align: center;">
                    <!-- Centrare text -->
                    <div class="footer_widget">
                        <h3 class="footer_title">More</h3>
                        <ul class="footer_links" style="list-style: none; padding: 0; margin: 0;">
                            <li>
                                <a href="https://pregnancyarchive.com/blog/exploring-the-factors-that-determine-the-viability-of-pregnancy-insights-into-the-journey-of-becoming-a-parent">Blog</a>
                            </li>
                            <li><a href="https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-022-02632-6">Article</a>
                            </li>
                            <li><a href="https://www.youtube.com/watch?v=F_ssj7-8rYg&t=13s">YouTube</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<!--Adding JS files-->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>
    function scrollToBottom() {
        var messageBody = document.getElementById("messageArea");
        messageBody.scrollTop = messageBody.scrollHeight;
    }

    $(document).ready(function () {
        let messageId = 0; 

        $("#messageArea").on("submit", function (event) {
            event.preventDefault();

            const userMessage = $("#text").val();

            if (!userMessage.trim()) {
                alert("Mesajul nu poate fi gol!");
                return;
            }

        const userHtml = `
        <div class="d-flex justify-content-end mb-4" id="userMessage_${messageId}">
          <div class="msg_cotainer_send">${userMessage}
            <span class="msg_time_send">${new Date().toLocaleTimeString()}</span>
          </div>
          <div class="img_cont_msg">
            <img
              src="{{ url_for('static', filename='images/user.png') }}"
              class="rounded-circle user_img_msg"
            />
          </div>
        </div>
      `;
            $("#text").val("");  
            $("#messageForm").append(userHtml); 
            scrollToBottom();

            fetch("/get", {
                method: "POST",
                headers: {"Content-Type": "application/x-www-form-urlencoded"},
                body: `msg=${encodeURIComponent(userMessage)}`
            })
                .then(response => {

          const botHtml = `
          <div class="d-flex justify-content-start mb-4" id="botMessage_${messageId}">
            <div class="img_cont_msg">
              <img
                src="{{ url_for('static', filename='images/robot.jpg') }}"
                class="rounded-circle user_img_msg"
              />
            </div>
            <div class="msg_cotainer" id="botMessageContainer_${messageId}">
            </div>
          </div>
        `;
                    $("#messageForm").append(botHtml); 
                    scrollToBottom();

                    const botContainer = document.getElementById(`botMessageContainer_${messageId}`);
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");

                    function read() {
                        reader.read().then(({done, value}) => {
                            if (done) return;
                            botContainer.innerHTML += decoder.decode(value);  
                            scrollToBottom();
                            read();
                        });
                    }

                    read();
                })
                .catch(() => {
                    alert("Eroare la trimiterea mesajului.");
                });

            messageId++;  
        });
    });
</script>

</body>

</html>